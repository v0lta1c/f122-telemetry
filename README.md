A telemetry parser application for Codemaster's game F1 22.

This application includes:

1. Telemetry parsing for F1 22.
2. A http-server acting as an API endpoint with some race information.
3. Possible discord bot integration using the API endpoint.

**Pre-requisite:**
Python 3 installed on your system
Qt graphical library for python

To install Qt: 
- Open your terminal
- run: `pip install pyside6`
- and you're set!

If you want to run the whole application in a virtual environment then i'd suggest installing pyside in that same environment as well.

To run the application:
- Open your terminal
- Navigate to the src/ directory
- run: `py main.py`
 
> [!WARNING]
> The discord bot script is NOT included in this repo.
> You can make it on your own following the socket host, port and the information syntax included in main.py
  

##  Telemetry Parsing

The parser parses the following packets generated by the game:

1. Session Packet
2. Lap Data Packet
3. Event Packet
4. Participants Packet
5. Car Telemetry Packet
6. Car Status Packet
7. Final Classification Packet
8. Car Damage Packet

**Output**
The final race details are printed on the terminal.

Other than the final race output, the parser also handles some IPC services intended for the discord integration (will be explained further below).
These are sent to the bot script under a specific socket which ONLY happens if "enable discord bot" check box was selected on the first window.

> [!IMPORTANT]
> By default, the parser socket runs on localhost (127.0.0.1) and port 20777 (default game port)
> It can be changed in the file `constants.py` under the variables
> ```
> IP = "127.0.0.1";	# Change IP if needed
> UDP_PORT = 20777;	# Default port for F1 2022
> ```

## API endpoint details

There are currently two API-endpoints on the server:

- '/api/test'
  - Outputs the string `HELLO RACERS!`
- '/api/raceData'
  - Outputs json:
    - ```
      {
        TrackName,
        SessionType,
        Vehicles: {
                      Name:
                      Position:
                      Total-time:
                      Best-lap-time:
                      Penalties:
                      Total-laps:
                      No-of-pitstops:
                      Result-Status:
                  }
      }
      ```
    - The number of vehicles included in the json depends on the numbner of participants in the session.
    - Vehicles are sorted based on the final race position.

> [!IMPORTANT]
> By default the http-server socket runs on localhost (127.0.0.1) and port (8000)
> This can be changed in the file `server.py`'s method `run_server` at the line:
> ```
>     port = 8000;
>     server_address = ('', port);
>     httpd = HTTPServerHandler(server_address, HTTPRequestHandler, stop_event)
> ```
> This will be added in `constants.py` in the future for more accessibility.


##  Discord bot script integration

The script is expected to run on localhost on the port `20002`, which can be edited in `constants.py` at:
```
#   Host and Ports for the discord bot IPC
IP_discordIPC = "127.0.0.1";
PORT_discordIPC = 20002;
```

The application runs a client socket (server is on the bot script)
The parser sends the following strings via the socket:
- Pit Status:
  -  Whenever a driver exits the pits, their name along with their current fitted tyres with the age is sent.
  -  Example: `PIT_CHANGE: Driver {driverName} is leaving the pits with {tyreAge} laps old {tyreCompound}`
- Events:
  - Fastest Lap:
    - Triggers whenever someone sets the fastest lap in the session.
    - Example: `FASTEST_LAP: Driver {driverName} has just set the fastest lap time of {time}`
  - Penalty Issued:
    - Drive Through:
      - Triggers on a drive through penalty.
      - Example: `DRIVE_THROUGH: Driver {driverName} has been issued a drive through penalty.`
    - Time Penalty:
      - Triggers when someone is issued a time penalty.
      - Example: `TIME_PENALTY: Driver {driverName} has been issued a time penalty.`
  - Retirement:
    - Triggers when someone retires from the race.
    - Example: `RETIREMENT: Driver {driverName} has retired from the session.`

**What can you do with this information?**
A possible thing that you can do (which i've implemented) is set the bot script to output the following information in a discord channel as real-time updates or use it as tts for commentary üòÅ


## Regarding bugs
There are some bugs in the application that i'm currently working on, however if you happen to encounter any bugs please feel free to contact me regarding it. Work on it is slow at the moment but I'll get on fixing it whenever i can!

## Future Updates
I do have some plans to add more functionality and ease of use for the software. I cannot commit to everything right now so instead i'm mentioning the things here that I CAN complete in the reasonable future.

Planned:
- [ ] Improve code readability by adding comments/restructuring some code etc.
- [ ] Add more features to the GUI like graghs, player lap history etc.

If you have any ideas of your own which do not expand the scope of the application by a big margin please let me know!

